<!DOCTYPE html>
<link rel="import" href="../polymer/polymer-element.html">
<script src="../ag-grid/dist/ag-grid.noStyle.js"></script>
<dom-module id="xtal-silver">


  <script>
    /**
     * `xtal-silver`
     * IE11-compatible AG-Grid web wrapper
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class XtalSilver extends Polymer.Element {
      static get is() { return 'xtal-silver'; }
      static get properties() {
        return {
          gridOptions:{
            type: Object,
            observer: 'onPropsChange'
          },
          iframeSrc:{
            type: String,
            value: '/bower_components/xtal-silver/iFrameContent.html' 
          }
        };
      }
      static isMSBrowser(){
        return document.documentMode || /Edge/.test(navigator.userAgent);
      }
      static get template() {
        if (XtalSilver.isMSBrowser()) {
          return `
          <style>
      :host {
        display: block;
      }
    </style>
    <iframe id="myIFrame" frameBorder="0" style="width:100%;height:100%" src$="[[iframeSrc]]"></iframe>`
        } else {
          return `

    <link rel="stylesheet" on-load="loaded" type="text/css" href="/bower_components/ag-grid/dist/styles/ag-grid.css">
    <link rel="stylesheet" on-load="loaded" type="text/css" href="/bower_components/ag-grid/dist/styles/ag-theme-material.css">
    <div id="myGrid" style="height: 115px;width:500px" class="ag-theme-material"></div>
        `;
        }

      }
      onPropsChange(){
        if(XtalSilver.isMSBrowser()){
          console.log('iah1');
          var iFrame = this.$.myIFrame;
          console.log('iah2');
          if(!iFrame || !iFrame.contentWindow || !iFrame.contentWindow.setGridOptions){
            console.log('iah3');
            setTimeout(() =>{
              this.onPropsChange(), 100
            });
            return;
          }
          console.log('passed the tests');
          iFrame.contentWindow.setGridOptions(this.gridOptions);
        }else{
          var eGridDiv = this.$.myGrid;

          // create the grid passing in the div to use together with the columns & data we want to use
          new agGrid.Grid(eGridDiv, this.gridOptions);
        }

      }
      
    }

    window.customElements.define(XtalSilver.is, XtalSilver);
  </script>
</dom-module>